<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMaLab 마케팅 자동화 플랫폼</title>
    <!-- Quill Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <div class="tabs">
            <button class="tab-btn" data-tab="process">상위 블로그 분석</button>
            <button class="tab-btn" data-tab="generate">AI 블로그(이미지) 생성</button>
            <button class="tab-btn" data-tab="ideas">AI 블로그 제목 + 프롬프트 생성</button>
        </div>

        <div class="content">
            <div id="error" class="error" style="display: none;"></div>

            <!-- 네이버 상위 블로그 분석 탭 -->
            <div id="process-tab" class="tab-content">
                <div class="form-section">
                    <h2>상위 블로그 분석</h2>
                    <div class="form-group">
                        <label>검색 키워드</label>
                        <input type="text" id="process-keyword" placeholder="예: 아임웹 홈페이지 제작">
                    </div>
                    <div class="form-group">
                        <label>처리할 블로그 개수</label>
                        <input type="number" id="process-count" value="3" min="1" max="3">
                        <small class="form-help">무료버전은 최대 3개까지만 가능합니다.</small>
                    </div>
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="process-analyze" checked>
                            <span>키워드 분석 수행</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label>상위 N개 키워드</label>
                        <input type="number" id="process-topn" value="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label>최소 키워드 길이</label>
                        <input type="number" id="process-minlength" value="2" min="1">
                    </div>
                    <div class="form-group">
                        <label>최소 출현 횟수</label>
                        <input type="number" id="process-mincount" value="2" min="1">
                    </div>
                    <button onclick="handleProcess()">분석 시작</button>
                    <div id="process-usage-info" class="usage-info" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 0.9rem; color: #666;">
                        <span id="process-usage-text">사용량 확인 중...</span>
                    </div>
                    
                    <!-- 로딩 영역 (상위 블로그 분석 탭 전용) -->
                    <div id="process-loading" class="loading" style="display: none; margin-top: 20px;">
                        <div class="spinner"></div>
                        <p id="process-loading-message">처리 중...</p>
                        <div id="process-loading-steps" class="loading-steps"></div>
                    </div>
                </div>
            </div>

            <!-- GPT 블로그 생성 탭 -->
            <div id="generate-tab" class="tab-content">
                <div class="form-section">
                    <h2>AI 블로그(이미지) 생성</h2>
                    
                    <div class="form-group">
                        <label class="required">키워드</label>
                        <input type="text" id="generate-keywords" placeholder="예: 아임웹 홈페이지 제작" maxlength="100" required>
                        <small class="form-help">블로그 글의 주요 키워드를 입력하세요. 검색 최적화(SEO)를 위해 사용될 핵심 키워드입니다. (최대 100자)</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">카테고리</label>
                        <div class="category-selector">
                            <select id="generate-category-main" required>
                                <option value="">대분류 선택</option>
                                <option value="entertainment">엔터테인먼트·예술</option>
                                <option value="life">생활·노하우·쇼핑</option>
                                <option value="hobby">취미·여가·여행</option>
                                <option value="knowledge">지식·동향</option>
                            </select>
                            <select id="generate-category-sub" required disabled>
                                <option value="">소분류를 선택하세요</option>
                            </select>
                        </div>
                        <small class="form-help">먼저 대분류를 선택한 후 소분류를 선택하세요. 네이버 블로그 카테고리와 동일한 구조입니다.</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="required">블로그 레벨</label>
                        <select id="generate-blog-level" required>
                            <option value="new">신규 (2000~2500자)</option>
                            <option value="mid" selected>중급 (2500~3000자)</option>
                            <option value="high">고지수 (3000~3500자 이상)</option>
                        </select>
                        <small class="form-help">글의 길이와 상세도를 선택하세요. 고지수 레벨은 FAQ와 더 많은 섹션을 포함합니다.</small>
                    </div>

                    <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <label class="checkbox-label" style="margin-bottom: 0;">
                                <input type="checkbox" id="generate-use-auto-reference" checked>
                                <span class="required">상위 블로그 참고(1~3)</span>
                            </label>
                        </div>
                        <div class="form-group" style="margin-top: 8px;">

                            <input type="number" id="generate-reference-count" value="3" min="1" max="10">
                        </div>
                        <small class="form-help">
                            체크 해제 시 자동 수집을 사용하지 않습니다. 아래에서 직접 참고할 블로그 URL을 추가할 수 있습니다.
                        </small>
                    </div>

                    <div class="form-group">
                        <label>참고용 블로그 URL
                            <span style="font-weight: normal; color: #666; font-size: 0.9em;">
                                (한 줄에 하나씩)
                            </span>
                        </label>
                        <div id="reference-blogs-container" class="external-links-container">
                            <!-- JS에서 행이 동적으로 추가됩니다 -->
                        </div>
                        <button type="button" id="add-reference-blog-btn" class="btn-secondary-small">+ 블로그 추가</button>
                        <small class="form-help">
                            상위 블로그 자동 수집과 별도로, 직접 참고하고 싶은 블로그 글 URL을 추가할 수 있습니다.
                        </small>
                    </div>
                    
                    <div class="form-group">
                        <label>추가 금칙어 <span style="font-weight: normal; color: #666; font-size: 0.9em;">(선택사항)</span></label>
                        <input type="text" id="generate-ban-words" placeholder="예: 추가금칙어1, 추가금칙어2" maxlength="200">
                        <small class="form-help">기본 금칙어가 자동으로 적용됩니다. 여기에 추가로 적용할 금칙어를 쉼표(,)로 구분하여 입력하세요. (최대 200자)</small>
                    </div>

                    <div class="form-group">
                        <label>외부 링크
                            <span style="font-weight: normal; color: #666; font-size: 0.9em;">
                                (한 줄에 하나씩, 신규 레벨에서는 비활성화)
                            </span>
                        </label>
                        <div id="external-links-container" class="external-links-container">
                            <!-- JS에서 행이 동적으로 추가됩니다 -->
                        </div>
                        <button type="button" id="add-external-link-btn" class="btn-secondary-small">+ 링크 추가</button>
                        <small class="form-help">
                            블로그 본문에 자연스럽게 넣고 싶은 외부 링크를 입력하세요. 신규 레벨(new)에서는 사용되지 않습니다.
                        </small>
                    </div>

                    <div class="form-group">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <label class="checkbox-label" style="margin-bottom: 0;">
                                <input type="checkbox" id="generate-images" checked>
                                <span>이미지 생성</span>
                            </label>
                        </div>
                        <div class="form-group" id="image-style-group" style="margin-top: 8px;">
                            <select id="image-style-select" name="image-style">
                                <option value="">이미지 스타일 선택</option>
                                <option value="photo">실사 (사진 스타일)</option>
                                <option value="illustration">애니메이션/일러스트</option>
                            </select>
                        </div>
                        <small class="form-help">
                            체크 해제 시 이미지 마커는 생성되지만 실제 이미지는 생성하지 않습니다.
                        </small>
                    </div>
                    
                    <button onclick="handleGenerateBlog()">블로그 생성</button>
                    <div id="generate-usage-info" class="usage-info" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 0.9rem; color: #666;">
                        <span id="generate-usage-text">사용량 확인 중...</span>
                    </div>
                    
                    <!-- 로딩 영역 (블로그 생성 탭 전용) -->
                    <div id="generate-loading" class="loading" style="display: none; margin-top: 20px;">
                        <div class="spinner"></div>
                        <p id="generate-loading-message">처리 중...</p>
                        <div id="generate-loading-steps" class="loading-steps"></div>
                    </div>
                </div>
            </div>

            <!-- 블로그 아이디어 생성 탭 -->
            <div id="ideas-tab" class="tab-content">
                <div class="form-section">
                    <h2>AI 블로그 작성 프롬프트 생성</h2>

                    <div class="form-group">
                        <label class="required">대표 키워드</label>
                        <input type="text" id="ideas-keyword" placeholder="예: 아임웹 홈페이지 제작" maxlength="100" required>
                        <small class="form-help">핵심 키워드를 1~2개 정도 입력하세요. (예: 아임웹 홈페이지 제작, 스마트스토어 마케팅)</small>
                    </div>

                    <div class="form-group">
                        <label class="required">주제 / 방향</label>
                        <input type="text" id="ideas-topic" placeholder="예: 소상공인을 위한 홈페이지 제작 가이드" maxlength="150">
                        <small class="form-help">이 키워드로 어떤 방향의 글을 쓰고 싶은지 한 문장으로 적어주세요. (체크박스 선택 시 비워도 됩니다)</small>
                        <div class="checkbox-group" style="margin-top: 6px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ideas-auto-topic">
                                <span>주제 / 방향을 GPT에게 추천받기 (키워드와 블로그 특징만으로 자동 설정)</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="required">내 블로그의 특징</label>
                        <textarea id="ideas-blog-profile" rows="3" placeholder="예: 
- 주 타깃: 30대 여성 자영업자
- 톤: 친근하지만 전문적인 느낌
- 주로 다루는 내용: 온라인 마케팅, 홈페이지 제작 사례 공유" maxlength="500"></textarea>
                        <small class="form-help">블로그 톤, 타깃, 주로 다루는 주제 등을 자유롭게 적어주세요. 프롬프트에 최대한 반영됩니다.</small>
                    </div>

                    <div class="form-group">
                        <label>추가 프롬프트 (선택)</label>
                        <textarea id="ideas-extra-prompt" rows="3" placeholder="예: 
- 제목에는 반드시 '아임웹' 키워드가 들어가게 해줘
- 프롬프트에는 도입-본문-결론 구조를 꼭 포함해줘
- 글 길이는 최소 2500자 이상을 목표로 해줘" maxlength="600"></textarea>
                        <small class="form-help">제목/프롬프트에 꼭 반영되었으면 하는 추가 요구사항을 적어주세요.</small>
                    </div>

                    <div class="form-group">
                        <label class="required">생성 개수</label>
                        <input type="number" id="ideas-count" value="3" min="1" max="10">
                        <small class="form-help">무료버전은 1개 ~ 3개까지 한 번에 생성할 수 있습니다.</small>
                    </div>

                    <button id="ideas-generate-btn" onclick="handleGenerateIdeas()">프롬프트 생성</button>
                    <div id="ideas-usage-info" class="usage-info" style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 6px; font-size: 0.9rem; color: #666;">
                        <span id="ideas-usage-text">사용량 확인 중...</span>
                    </div>
                    <p id="ideas-status" class="status-text" style="display: none; margin-top: 8px; font-size: 0.9rem; color: #667eea;">
                        제목과 프롬프트를 생성 중입니다...
                    </p>

                    <!-- 로딩 영역 (아이디어 생성 탭 전용) -->
                    <div id="ideas-loading" class="loading" style="display: none; margin-top: 20px;">
                        <div class="spinner"></div>
                        <p id="ideas-loading-message">처리 중...</p>
                        <div id="ideas-loading-steps" class="loading-steps"></div>
                    </div>
                </div>
            </div>

            <div id="result" class="result">
                <div class="result-header">
                    <h3>생성된 블로그 내용</h3>
                    <div class="result-actions">
                        <button onclick="copyBlogContentToNaverEditor()" class="btn-copy">내용 복사하기</button>
                    </div>
                </div>
                
                <div id="result-content"></div>
                
                <div class="blog-editor-sections">
                    <!-- 제목 영역 -->
                    <div class="editor-section">
                        <label class="section-label">제목</label>
                        <div id="result-title" class="blog-editor blog-editor-title"></div>
                    </div>
                    
                    <!-- 본문 영역 -->
                    <div class="editor-section">
                        <label class="section-label">본문</label>
                        <div id="result-body" class="blog-editor blog-editor-body"></div>
                    </div>
                    
                    <!-- 태그 영역 -->
                    <div class="editor-section">
                        <label class="section-label">태그</label>
                        <div id="result-tags" class="blog-editor blog-editor-tags"></div>
                    </div>

                    <!-- 네이버 발행용 파일 다운로드 버튼 -->
                    <div class="editor-section">
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button id="export-blog-btn" class="btn-export" onclick="handleExportBlog()">
                                발행용 파일 다운로드
                            </button>
                            <button id="download-images-btn" class="btn-export" onclick="handleDownloadImages()" style="display: inline-block;">
                                이미지 다운로드
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 블로그 아이디어 결과 영역 -->
            <div id="ideas-result" class="result" style="display: none;">
                <div class="result-header">
                    <h3>생성된 블로그 프롬프트</h3>
                    <div class="result-actions">
                        <button id="ideas-download-zip-btn" class="btn-export" style="display: none;">
                            전체 다운로드
                        </button>
                    </div>
                </div>
                <div id="ideas-result-content"></div>
            </div>
        </div>
    </div>

    <!-- Quill Editor JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="app.js"></script>
</body>
</html>
